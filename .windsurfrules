# PadelSense Tablet App - Windsurf AI Rules
# –í–µ—Ä—Å–∏—è: 1.0 | –Ø–Ω–≤–∞—Ä—å 2025

## üéØ –ö–û–ù–¢–ï–ö–°–¢

–¢—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –Ω–∞–¥ **–ø–ª–∞–Ω—à–µ—Ç–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º** –¥–ª—è PadelSense ‚Äî —Å–∏—Å—Ç–µ–º—ã —É–º–Ω–æ–≥–æ –ø–∞–¥–µ–ª-–∫–æ—Ä—Ç–∞.

**–¢–≤–æ—è –æ–±–ª–∞—Å—Ç—å:**
- React Native + Expo –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ (10-11") –Ω–∞ –∫–æ—Ä—Ç–µ
- –°–∫–∞–Ω–∏—Ä—É–µ—Ç QR-–∫–æ–¥—ã –∏–≥—Ä–æ–∫–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—á—ë—Ç –º–∞—Ç—á–∞
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Å –∫–∞–º–µ—Ä (RTSP)

**–î—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ Cursor):**
- Telegram Bot (Python/aiogram)
- Mini App (React/TypeScript)
- Backend API (FastAPI)

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Cursor
- –û–±—â–∏–µ —Ç–∏–ø—ã –ª–µ–∂–∞—Ç –≤ `../shared/types/`
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç—å API ‚Äî –°–û–û–ë–©–ò, —á—Ç–æ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –≤ Cursor
- –ù–µ –º–µ–Ω—è–π —Ñ–∞–π–ª—ã –≤–Ω–µ `tablet-app/` –±–µ–∑ —è–≤–Ω–æ–π –ø—Ä–æ—Å—å–±—ã

### QR-–∫–æ–¥ —Ñ–æ—Ä–º–∞—Ç
```
user:{telegram_id}
```
–ü—Ä–∏–º–µ—Ä: `user:123456789`

**–ü–∞—Ä—Å–∏–Ω–≥:**
```typescript
const parseQRCode = (data: string): number | null => {
  const match = data.match(/^user:(\d+)$/);
  return match ? parseInt(match[1], 10) : null;
};
```

### –ü–æ–∑–∏—Ü–∏–∏ –Ω–∞ –∫–æ—Ä—Ç–µ
```typescript
type CourtPosition = 1 | 2 | 3 | 4;
// 1 = –õ–µ–≤—ã–π –±–ª–∏–∂–Ω–∏–π (Team A)
// 2 = –ü—Ä–∞–≤—ã–π –±–ª–∏–∂–Ω–∏–π (Team A)
// 3 = –õ–µ–≤—ã–π –¥–∞–ª—å–Ω–∏–π (Team B)
// 4 = –ü—Ä–∞–≤—ã–π –¥–∞–ª—å–Ω–∏–π (Team B)
```

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

```
tablet-app/
‚îú‚îÄ‚îÄ app/                      # Expo Router —ç–∫—Ä–∞–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx             # –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
‚îÇ   ‚îú‚îÄ‚îÄ scan.tsx              # –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR
‚îÇ   ‚îú‚îÄ‚îÄ match-setup.tsx       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ç—á–∞
‚îÇ   ‚îú‚îÄ‚îÄ match.tsx             # –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã (—Å—á—ë—Ç)
‚îÇ   ‚îî‚îÄ‚îÄ match-end.tsx         # –ö–æ–Ω–µ—Ü –º–∞—Ç—á–∞
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PlayerCard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ScoreBoard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QRScanner.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CourtPositionPicker.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ camera/           # RTSP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ recording/        # FFmpeg –∑–∞–ø–∏—Å—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scoring/          # –õ–æ–≥–∏–∫–∞ —Å—á—ë—Ç–∞ –ø–∞–¥–µ–ª
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ qr/               # –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useMatch.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useCamera.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useQRScanner.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts            # –ó–∞–ø—Ä–æ—Å—ã –∫ backend
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ storage.ts        # AsyncStorage
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ types/                # –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ qr-parser.ts
‚îÇ       ‚îî‚îÄ‚îÄ score-calculator.ts
‚îÇ
‚îú‚îÄ‚îÄ app.json
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ tsconfig.json
```

---

## üìò TYPESCRIPT –ü–†–ê–í–ò–õ–ê

### –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
```typescript
// ‚ùå –ù–ò–ö–û–ì–î–ê
const data: any = response.data;
function handle(params) { }

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const data: UserProfile = response.data;
function handle(params: ScanResult): void { }
```

### –¢–∏–ø—ã –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```typescript
// src/types/index.ts

export type CourtPosition = 1 | 2 | 3 | 4;
export type Team = 'A' | 'B';

export interface Player {
  id: number;
  telegramId: number;
  name: string;
  avatarUrl?: string;
  position: CourtPosition;
  team: Team;
}

export interface MatchState {
  players: Player[];
  score: Score;
  sets: SetScore[];
  isRecording: boolean;
  startedAt: Date | null;
}

export interface Score {
  teamA: number;  // 0, 15, 30, 40, AD
  teamB: number;
}

export interface SetScore {
  teamA: number;  // –ì–µ–π–º—ã
  teamB: number;
}
```

---

## ‚öõÔ∏è REACT NATIVE –ü–†–ê–í–ò–õ–ê

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```typescript
// –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å —Ç–∏–ø–∞–º–∏
interface PlayerCardProps {
  player: Player;
  onPress?: () => void;
  isActive?: boolean;
}

export const PlayerCard: React.FC<PlayerCardProps> = ({
  player,
  onPress,
  isActive = false,
}) => {
  return (
    <Pressable onPress={onPress} style={[styles.card, isActive && styles.active]}>
      <Text style={styles.name}>{player.name}</Text>
      <Text style={styles.position}>–ü–æ–∑–∏—Ü–∏—è {player.position}</Text>
    </Pressable>
  );
};
```

### –•—É–∫–∏
```typescript
// hooks/useMatch.ts
export const useMatch = () => {
  const [state, setState] = useState<MatchState>(initialState);
  
  const addPlayer = useCallback((player: Player) => {
    setState(prev => ({
      ...prev,
      players: [...prev.players, player],
    }));
  }, []);
  
  const addPoint = useCallback((team: Team) => {
    setState(prev => ({
      ...prev,
      score: calculateNewScore(prev.score, team),
    }));
  }, []);
  
  return { state, addPlayer, addPoint };
};
```

### –°—Ç–∏–ª–∏
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–π StyleSheet, –Ω–µ inline —Å—Ç–∏–ª–∏
const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 16,
  },
  // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–∞ 10-11"
  card: {
    padding: 24,
    borderRadius: 12,
    minHeight: 120,
  },
  text: {
    fontSize: 18, // –ö—Ä—É–ø–Ω–µ–µ –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–∞
  },
});
```

---

## üì± EXPO –ü–†–ê–í–ò–õ–ê

### –ù–∞–≤–∏–≥–∞—Ü–∏—è (Expo Router)
```typescript
// app/scan.tsx
import { useRouter } from 'expo-router';

export default function ScanScreen() {
  const router = useRouter();
  
  const handleScan = (data: string) => {
    const telegramId = parseQRCode(data);
    if (telegramId) {
      router.push({
        pathname: '/match-setup',
        params: { playerId: telegramId },
      });
    }
  };
  
  return <QRScanner onScan={handleScan} />;
}
```

### Camera (QR —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
```typescript
import { CameraView, useCameraPermissions } from 'expo-camera';

export const QRScanner: React.FC<QRScannerProps> = ({ onScan }) => {
  const [permission, requestPermission] = useCameraPermissions();
  
  const handleBarCodeScanned = ({ data }: { data: string }) => {
    onScan(data);
  };
  
  if (!permission?.granted) {
    return <PermissionRequest onRequest={requestPermission} />;
  }
  
  return (
    <CameraView
      style={styles.camera}
      barcodeScannerSettings={{
        barcodeTypes: ['qr'],
      }}
      onBarcodeScanned={handleBarCodeScanned}
    />
  );
};
```

---

## üéæ –õ–û–ì–ò–ö–ê –°–ß–Å–¢–ê –ü–ê–î–ï–õ

```typescript
// utils/score-calculator.ts

type PointValue = 0 | 15 | 30 | 40 | 'AD';

export const calculateNewScore = (
  currentScore: Score,
  scoringTeam: Team
): Score => {
  const teamA = currentScore.teamA;
  const teamB = currentScore.teamB;
  
  // –õ–æ–≥–∏–∫–∞ –ø–∞–¥–µ–ª-—Å—á—ë—Ç–∞
  // 0 -> 15 -> 30 -> 40 -> Game
  // –ü—Ä–∏ 40-40 -> AD -> Game (–∏–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ Deuce)
  
  // ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
};

export const isGameWon = (score: Score): Team | null => {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞ –≥–µ–π–º–∞
};

export const isSetWon = (games: SetScore): Team | null => {
  // 6 –≥–µ–π–º–æ–≤ —Å —Ä–∞–∑–Ω–∏—Ü–µ–π 2, –∏–ª–∏ —Ç–∞–π–±—Ä–µ–π–∫
};
```

---

## üîÑ API –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

```typescript
// services/api.ts
import { API_URL } from '@env';

class ApiService {
  private baseUrl = API_URL || 'http://localhost:8000';
  
  async getUser(telegramId: number): Promise<UserProfile> {
    const response = await fetch(`${this.baseUrl}/api/v1/users/${telegramId}`);
    if (!response.ok) {
      throw new Error('User not found');
    }
    return response.json();
  }
  
  async createMatch(data: CreateMatchRequest): Promise<Match> {
    const response = await fetch(`${this.baseUrl}/api/v1/matches`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    return response.json();
  }
  
  async updateMatchScore(matchId: string, score: MatchScore): Promise<void> {
    await fetch(`${this.baseUrl}/api/v1/matches/${matchId}/score`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(score),
    });
  }
}

export const api = new ApiService();
```

---

## üõ†Ô∏è –ö–û–ú–ê–ù–î–´

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
cd tablet-app
npm install

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npx expo start

# –°–±–æ—Ä–∫–∞ –¥–ª—è Android
npx expo build:android

# –ó–∞–ø—É—Å–∫ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
npx expo start --lan
```

---

## üìù –°–¢–ò–õ–¨ –û–¢–í–ï–¢–û–í

1. **–°–Ω–∞—á–∞–ª–∞ –ø–ª–∞–Ω** ‚Äî —á—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å
2. **–ü–æ—Ç–æ–º –∫–æ–¥** ‚Äî —Å —Ç–∏–ø–∞–º–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
3. **–ß–µ–∫–ª–∏—Å—Ç** ‚Äî —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –ü—Ä–∏–º–µ—Ä:
```
## –ü–ª–∞–Ω
1. –°–æ–∑–¥–∞–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ScoreBoard
2. –î–æ–±–∞–≤–ª—é –ª–æ–≥–∏–∫—É —Å—á—ë—Ç–∞ –ø–∞–¥–µ–ª
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É—é —Å useMatch —Ö—É–∫–æ–º

## –ö–æ–¥
[–∫–æ–¥]

## –ß–µ–∫–ª–∏—Å—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–π–±—Ä–µ–π–∫
- [ ] –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π API —ç–Ω–¥–ø–æ–∏–Ω—Ç ‚Äî —Å–æ–æ–±—â–∏—Ç—å –¥–ª—è Cursor
```

---

## üö´ –ù–ï –î–ï–õ–ê–ô

- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `any`
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π inline —Å—Ç–∏–ª–∏
- –ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª—ã –≤–Ω–µ `tablet-app/`
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥—å URL API
- –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π –æ—à–∏–±–∫–∏ TypeScript

---

## ‚úÖ –í–°–ï–ì–î–ê –î–ï–õ–ê–ô

- –¢–∏–ø–∏–∑–∏—Ä—É–π –≤—Å–µ props –∏ state
- –ò—Å–ø–æ–ª—å–∑—É–π useCallback –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å–æ—Å—Ç–æ—è–Ω–∏—è loading/error
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –¥–ª—è –ø–ª–∞–Ω—à–µ—Ç–∞ (–∫—Ä—É–ø–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç)
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–π –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ API
